# 可编程函数

在 biForm 中，每个控件的属性编辑器里，有一个分类“脚本”，是开放给开发者的，可由开发者写入自己的 Python 代码，它们运行时都是以 Python 函数的形式存在。

?> PFF运行时引擎调用这些函数时，都是返回为可变数据类型（QVariant），然后再按使用的场合转换成相应的数据类型。比如“缺省值”的返回值会用于赋值给文本输入控件的字符串属性text，所以运行时引擎会尝试将返回值转换为字符串型，如果不能转换成功，会转换为空字符串。虽然运行时引擎支持这种转换，但建议尽量在程序中使用合适的数据类型，以避免转换出现不可预期的结果。

?> 这些函数可以直接在其它脚本处通过函数名进行调用，比如控件名为 lineedit，可以在其它地方使用 v=lineedit_validator() 调用其“校验规则”函数，从而可以复用这段程序。这种调用不会影响到 lineedit 控件的行为。但我们一般不建议开发者这样使用，因为函数名与控件名相关，如果需要修改控件名，相关的脚本都要进行修改。如果一定需要复用这部分程序，更好的做法是在表单的“公用模块”里定义表单级的公用函数后再在各处进行调用。

biForm 中的标准控件有一些通同的可编程函数，它们有相同的接口，只是在每个控件中的意义和使用场合不同。每类控件也有独有的可编程函数。以下分别进行说明，具体每个控件的接口请查看控件的详细API文档。

|控件类型|可编程函数|
|所有控件|[鼠标进入时](#enter)<br>[鼠标进入时](#leave)|
|有输入焦点的控件|[获得焦点时](#getfocus)<br>[失去焦点时](#lostfocus)|
|带缺省值的控件|[缺省值](#default)|
|可进行格式转换的控件|[显示格式](#format)|
|可进行数据校验的控件|[校验规则](#validator)|
|可点击的控件|[点击时](#clicked)|
|分页控件特有|[切换分页时](#tabchanged)|
|表格控件特有|[编辑器](#editor)|

## 所有控件

适用的控件：所有控件

- ### enter

**可编程函数：鼠标进入时**

|内容|说明|
| - | - |
|函数名|控件名_enter|
|传入参数|无|
|返回值|无|
|建议的返回值类型|无|
|使用规则|鼠标光标进入到这个控件时调用此函数。|

- ### leave

**可编程函数：鼠标离开时**

|内容|说明|
| - | - |
|函数名|控件名_leave|
|传入参数|无|
|返回值|无|
|建议的返回值类型|无|
|使用规则|鼠标光标离开这个控件时调用此函数。|

- ### resize

**可编程函数：大小改变时**

|内容|说明|
| - | - |
|函数名|控件名_resize|
|传入参数|无|
|返回值|无|
|建议的返回值类型||
|使用规则|控件大小改变时调用此函数。|

- ### dragEnter

**可编程函数：拖曳进入时**

|内容|说明|
| - | - |
|函数名|控件名_dragEnter|
|传入参数1|format:元数据的格式列表，以列表类型传入|
|传入参数2|data:元数据的内容|
|传入参数3|dx:鼠标位置x坐标值|
|传入参数4|dy:鼠标位置y坐标值|
|返回值|是否接受拖曳进入|
|建议的返回值类型|布尔|
|使用规则|当从外部拖曳一些内容进入到这个控件时，会调用此函数。不接受拖曳的控件不会调用此函数。通过脚本判断是否接受拖曳，如果接受，返回 True，否则返回False。返回 True 之后，程序将会调用“当拖曳放下时”函数。|

- ### drop

**可编程函数：拖曳放下时**

|内容|说明|
| - | - |
|函数名|控件名_drop|
|传入参数1|format:元数据的格式列表，以列表类型传入|
|传入参数2|data:元数据的内容|
|传入参数3|dx:鼠标位置x坐标值|
|传入参数4|dy:鼠标位置y坐标值|
|返回值|是否接受拖曳进入|
|建议的返回值类型|布尔|
|使用规则|当从外部拖曳放下一些内容到这个控件时调用此函数。当接受拖曳放下时，返回 True，否则返回 False。|

- ### mimedata

**可编程函数：生成元数据**

|内容|说明|
| - | - |
|函数名|控件名_mimedata|
|传入参数|无|
|返回值|这个控件的元数据|
|建议的返回值类型|列表|
|使用规则|这个函数会在拖曳这个控件时调用。返回的值必须是一个列表，类似于 [['text/plain','the drag text']]，列表中每个元素有两个子元素，第一个是数据的格式，第二个是数据的内容。|

- ### singleshot

**可编程函数：单次定时器超时时**

|内容|说明|
| - | - |
|函数名|控件名_singleshot|
|传入参数|无|
|返回值|无|
|建议的返回值类型|无|
|使用规则|在调用 ```控件名.startSingleShot(毫秒值)``` 后，时间点到达后会调用此函数，单次定时器只会调用一次就会停止。|

- ### timeout

**可编程函数：定时器超时时**

|内容|说明|
| - | - |
|函数名|控件名_timeout|
|传入参数|timerid：定时器的ID值|
|返回值|无|
|建议的返回值类型|无|
|使用规则|在调用 ```控件名.startTimer(毫秒值)``` 后，时间点到达后会调用此函数。定时器会重复超时，重复调用此函数，直到使用 killTimer 将定时器停止。|


## 有输入焦点的控件

适用的控件类型：单行文本输入框、多行文本输入框、复选框、单选按钮、日期编辑器、时间编辑器、日期时间编辑器、整数编辑器、双精度小数编辑器、下拉列表框、分组框、图像、分页控件、分组框、表格、树形控件、列表控件

- ### getfocus

**可编程函数：获得焦点时**

|内容|说明|
| - | - |
|函数名|控件名_getfocus|
|传入参数|无|
|返回值|无|
|建议的返回值类型|无|
|使用规则|在控件获得输入焦点时调用此函数。|

- ### lostfocus

**可编程函数：失去焦点时**

|内容|说明|
| - | - |
|函数名|控件名_lostfocus|
|传入参数|无|
|返回值|无|
|建议的返回值类型|无|
|使用规则|在控件失去输入焦点时调用这个函数。|

## 带缺省值的控件

- ### default

**可编程函数：缺省值**

适用的控件类型：单行文本输入框、多行文本输入框、复选框、单选按钮、日期编辑器、时间编辑器、日期时间编辑器、整数编辑器、双精度小数编辑器、下拉列表框、分组框、图像、分页控件、分组框

|内容|说明|
| - | - |
|函数名|控件名_default|
|传入参数|无|
|返回值|输入框中文本内容的初始值|
|建议的返回值类型|字符串型|
|使用规则|控件初始化后、新建空白表单后输入框中的文本会还原成初始值。|

## 可进行格式转换的控件

适用的控件类型：单行文本输入框

- ### format

**可编程函数：显示格式**

|内容|说明|
| - | - |
|函数名|控件名_format|
|传入参数|输入框中的文本|
|返回值|转换格式后要显示的文本|
|建议的返回值类型|字符串型|
|使用规则|单行文本输入框中输入的内容和显示的内容可以不一样，这个函数用来将输入的内容转换格式后显示，将在用户结束输入后调用此函数，通过程序修改文本内容也会调用此函数。|

## 可进行数据校验的控件

适用的控件类型：单行文本输入框、多行文本输入框、复选框、单选按钮、日期编辑器、时间编辑器、日期时间编辑器、整数编辑器、双精度小数编辑器、下拉列表框、分组框

- ### validator

**可编程函数：校验规则**

|内容|说明|
| - | - |
|函数名|控件名_validator|
|传入参数|输入框中的文本|
|返回值|输入值是否合法|
|建议的返回值类型|布尔型|
|使用规则|如果输入值满足要求，返回True，否则返回False。这个函数会在完成输入后被调用。手工输入和程序修改都会调用此函数。|

## 可点击的控件

适用的控件类型：按钮、分组框、复选框、单选按钮

- ### clicked

**可编程函数：点击时**

|内容|说明|
| - | - |
|函数名|控件名_clicked|
|传入参数|无|
|返回值|无|
|建议的返回值类型|无|
|使用规则|控件被点击时调用此函数。|

## 分页控件特有

适用的控件类型：分页控件

- ### tabchanged

**可编程函数：切换分页时**

|内容|说明|
| - | - |
|函数名|控件名_tabchanged|
|传入参数|index：当前分页的编号，从0开始序号|
|返回值|无|
|建议的返回值类型|无|
|使用规则|分页控件切换当前页时调用此函数。手动切换或程序切换都会调用。|

## 表格控件特有 

适用的控件类型：表格

- ### editor

**可编程函数：编辑器**

|内容|说明|
| - | - |
|函数名|控件名_editor|
|传入参数1|row：当前单元格的行号，从0开始编号|
|传入参数2|column：当前单元格的列号，从0开始编号|
|返回值|编辑器的名称|
|建议的返回值类型|字符串|
|使用规则|在需要创建表格的单元格的编辑器时调用，返回这个单元格需要使用的编辑器的名称，如果返回空字符串，会使用默认设定的文本编辑器。|


