# 表单设计 - 概述

## biForm 中“表单”的概念

用 biForm 开发应用程序， 一个最基础的概念就是“表单”。使用 biForm 需要遵循一定的应用框架，这个应用框架的核心就是  “一切都是表单”。在 biForm 的应用框架中，这些表单都被称为“PFF”即“portable form file”的缩写。

开发者只需要将应用程序的各项功能拆分成一个个表单，单独进行开发和发布，就可以在我们提供的各种运行时环境中，实现任意表单的即插即用和自由组合。

biForm 中的表单与我们常听到的“电子表单”概念上有所不同。通常我们将“销售订单”、“意见收集表”、 “参会报名表”这类用于填写数据的应用称为“电子表单”，但不会把“资产负债表”、“进度看板”、“批量导入工具”等称之为表单。但在 biForm 中，这些都被称为表单。只要是一个有独立的图形界面的、包含一些脚本可以执行的，都被称之为“表单”。

在 biForm 中，一个表单是有一定规范要求的，当然开发者并不需要自己去处理“如何满足这些规范”这样的问题，但在面对一项开发需求时，需要了解这些以便知道如何将一个应用程序拆分为不同的表单分别进行开发。

-  一个表单有且仅有一个主要的图形界面入口

biForm 中的表单是必须有图形化界面的，biForm通常并不是用于开发无界面应用的。但在运行时环境中，一个表单未必是“可见”的，图形界面也许并不显示出来，这取决于运行时引擎如何处理和使用这些表单，看不见的表单也只表示这个表单的图形界面在实际使用中并不重要或不需要显示。

biForm 中一个表单是不会有两个图形化界面的。一个表单通常会在主窗口里以子窗口形式显示，也可以以弹出对话框的形式显示。在一个表单中也可以调用系统提供的各种弹出对话框、调用其它表单做为弹出对话框，也可以用脚本调用和显示其它窗体。但不管如何调用外部的窗体控件，每个表单都是有且只有一个主要的窗体界面，这个主要的图形界面是这个表单所有功能的入口。

- 表单可以使用数据库也可以不使用

虽然在界面设计中有  “数据视图”的设计功能，但一个表单并不是必须要“显式地”使用数据库。之所以说“显式地”，是因为运行时引擎必然是有后台数据库的，所有表单在运行时，后台是需要数据库进行处理的，数据库也需要为其它表单提供支持。但如果表单本身没有需要读写数据库的需求，就不需要使用“数据视图”这项功能，但它运行时也还是在数据库环境下在运行，只是不需要“显式地”使用数据库。但即使不使用“数据视图”，表单也还是可以通过数据库连接对象访问运行时环境中的数据库，或者连接和访问外部数据源。

如果要在表单中读写数据库，比如保存一张“报名表”，或读取“记账凭证”的数据进行统计分析，建议使用 biForm 提供的数据视图来设计对数据库的访问。基于PFF的应用框架提供了跨平台、跨数据库、扩展性很强的数据库功能，如果自己使用自己的方法来实现数据库的读写操作，很容易会失去这些特性。只有在需要访问外部数据源与其它系统进行集成等特殊情况时才可能需要自己去实现数据库访问的问题。具体数据库相关的开发的技巧请参考其它相关章节。

## 运行时环境

PFF的运行时环境可以是多种多样的。比如我们发布的通用的运行时环境是 biReader 。我们也将发布一些特定的应用程序，比如各种打包好的管理软件（比如工资核算管理系统）、嵌入式开发的集成开发环境等，它们都包含了PFF运行时引擎，但它们有不同的用途，主体程序者是用 Qt 开发的，都支持PFF的即插即用和组合。

比如象工资核算管理系统这类应用程序，通常我们会发布一个标准的打包好的版本，其中已经包含了运行时引擎和一些PFF文件，已经能提供完整的工资管理的功能了。不同的客户可以通过添加新的PFF或者修改标准版本中的某些PFF来满足自己的个性化需求。

在嵌入式开发的集成开发环境的这个例子中，PFF做为扩展组件（或称为插件）对IDE的功能加以扩展。

## biForm 适合开发什么样的应用程序

并且提供了 Qt 库和 Python基础库及很多Python第三方库，而且也支持开发者自己添加更多的第三方库。所以从这个角度上讲，biForm能开发很多类型的应用程序。

但因为 biForm 基于一种低耦合的应用框架，所以那些内部功能之间耦合程度比较高、不适合对界面和功能进行拆分的应用程度就不适合用它来实现。

PFF本质上是文本文件，需要先加载和解析后才能使用，不适合把它做成一个特别大的单个文件，否则加载速度可能会不理想。虽然理论上讲，将一个大的应用程序完全塞进一个表单中也是可以实现的，但既复杂又不方便开发，也不方便进行测试和调试，不管从哪个方面讲都不是一个好的选择。比如用 biForm 开发出一个 biForm，就不合适。但这并不表示 biForm 就不能用于这类应用程序，biForm可以为这类应用程序提供扩展组件（或称插件），PFF做为这类应用程序的插件，也是一种很好的选择。

有一类应用程序，比如大型游戏，通常只有一个窗口，通过在这个窗口内切换场景提供不同的功能。这一点与PFF运行时，每个表单有一个子窗口或对话框不符合，所以目前也不适合用 biForm 来开发。但如果只是一个小游戏，一个表单就能实现并且生成的文件不会过于庞大，倒是可以试试。

目前我们的实践中，biForm很适合开发以下这些应用程序：

1.  各类数据库应用

这类软件包括各类管理软件、与数据库相关的各类工具。这类软件通常很容易拆分成一个个低耦合度的表单。我们在实践中已经有大量这类应用采用 biForm 进行开发，实施和运行效果都很好。

2.  需要快速开发的小应用

biForm使用Python本身就很适用于这类小应用，biForm提供了可视化的界面设计工具，更容易打包发布，相对于 PyQt 或 wxWidgets 是更好的选择。

3.  为其它应用开发扩展组件（或称插件）

如果您有用 Qt 开发的应用程序，希望能支持插件，也很适合使用基于PFF的解决方案。将PFF的运行时引擎加入您的代码中，您的应用程序就有了一个插件体系，biForm 开发的PFF就成为您的应用的扩展组件了。

##  开发步骤

完成一个PFF表单的开发通常包括以下步骤：

1. 设计表单界面

这一步包括使用所见即所得的界面设计器进行[界面设计](3-2-form)，也包括自定义[动作](3-4-action)的设置，和可能需要的[引用列表](3-5-reference)的设置。

2. 设计数据视图

如果需要使用PFF的数据库引擎，就需要这一步，如果不需要，可以跳过。这一步包括数据表的定义、表间关系和引用的定义、字段取值的脚本等相关内容。详细内容请参考[第四章 数据库](4-1-summary)中的内容。

3. 编写脚本

没有脚本的表单几乎没什么用。所以写脚本是必须的，表单、控件、动作、引用列表、数据表都有开放相应的可编程函数，在脚本编辑器中按设置好的模板填写相应的Python程序就可以了。详细内容请参考[脚本编辑](3-6-script)、[表单的公共模块](1-1-public)、[控件的可编程函数](1-4-openscript)、[表单的可编程函数](1-7-formscript)中的内容。

4. 试运行/调试

在 biForm 中就可以运行表单，但有些与环境和数据有关的功能可能在 biForm 的试运行环境下不容易进行程序测试和调试，所以在某些情况下，需要打包为PFF在 biReader 等运行时环境下进行测试和调试。详细内容请参考[第五章 测试和调试](5-1-summary)中的内容。

5. 打包为PFF文件

开发完成的表单，打包为PFF文件就可以发布给最终用户了。详细内容请参考[第六章 表单发布和运行时环境](6-1-runtime)中的内容。

